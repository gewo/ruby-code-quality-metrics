- type: parallel
  steps:
    - name: run code quality metrics tools
      service: ruby-code-quality-metrics
      command: ruby

- type: parallel
  steps:
    - name: push
      service: ruby-code-quality-metrics
      type: push
      image_name: gapfish/ruby-code-quality-metrics
      image_tag: "{{ .Branch }}-{{ .CommitID }}"
      registry: https://index.docker.io/v1/
      encrypted_dockercfg_path: dockercfg.codeship.encrypted

    - name: push-latest
      service: ruby-code-quality-metrics
      type: push
      image_name: gapfish/ruby-code-quality-metrics
      tag: master
      image_tag: latest
      registry: https://index.docker.io/v1/
      encrypted_dockercfg_path: dockercfg.codeship.encrypted

    - name: push-tag
      service: ruby-code-quality-metrics
      type: push
      image_name: gapfish/ruby-code-quality-metrics
      tag: "^v"
      image_tag: "{{ .Branch }}"
      registry: https://index.docker.io/v1/
      encrypted_dockercfg_path: dockercfg.codeship.encrypted
